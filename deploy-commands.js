const { SlashCommandBuilder, Routes } = require('discord.js')
const { REST } = require('@discordjs/rest')
const config = require('config')
// const { clientId, token } = require('./config.json');

const commands = [
  new SlashCommandBuilder().setName('admin').setDescription('Administration commands.')
    .addSubcommand(subcommand => subcommand.setName('add-user-role').setDescription('Add a role to a user.')
      .addUserOption(option => option.setName('user').setDescription('The user to give admin permissions to.').setRequired(true))
      .addStringOption(option => option.setName('role').setDescription('The user to give admin permissions to.').setRequired(true)
        .addChoices({ name: 'Admin', value: 'admin' })
        .addChoices({ name: 'Editor', value: 'editor' })
      )
    )
    .addSubcommand(subcommand => subcommand.setName('allow-corp-forwarding').setDescription('Allow a corporation\'s guild to post messages to a channel.')
      .addStringOption(option => option.setName('corp-guild-id').setDescription('The id of the corporation\'s guild to allow messages from.').setRequired(true))
      .addChannelOption(option => option.setName('forwardable-channel').setDescription('The channel to allow messages to be forwarded to.').setRequired(true))
    )
    // .addSubcommand(subcommand => subcommand.setName('backfill-kill-reports').setDescription('Read channel message history to find past kill reports.'))
    .addSubcommand(subcommand => subcommand.setName('find-past-kill-reports').setDescription('Read channel message history to find past kill reports.'))
    .addSubcommand(subcommand => subcommand.setName('list-corp-forwards').setDescription('List all corporation guild permissions to post messages to channels.'))
    .addSubcommand(subcommand => subcommand.setName('remove-corp-forwarding').setDescription('Remove a corporation\'s guild permission to post messages to a channel.')
      .addStringOption(option => option.setName('corp-guild-id').setDescription('The id of the corporation\'s guild to allow messages from.').setRequired(true))
      .addChannelOption(option => option.setName('forwardable-channel').setDescription('The channel to allow messages to be forwarded to.').setRequired(false))
    )
    .addSubcommand(subcommand => subcommand.setName('remove-admin').setDescription('Remove an admin user.')
      .addUserOption(option => option.setName('user').setDescription('The user to remove admin permissions from.').setRequired(true))
    )
    .addSubcommand(subcommand => subcommand.setName('kill-report-forwarding').setDescription('Configure kill report forwarding to an external channel.'))

    .addSubcommand(subcommand => subcommand.setName('setup-channel').setDescription('Setup up a channel for tracking kill reports.')
      // .addStringOption(option => option.setName('kill-tag').setDescription('An optional tag to associate all kills with.'))
    )
    .addSubcommand(subcommand => subcommand.setName('remove-channel').setDescription('Remove a channel from tracking kill reports.')
      .addChannelOption(option => option.setName('channel').setDescription('The channel to stop processing kill reports for.'))
    ),

  new SlashCommandBuilder().setName('corporation').setDescription('Commands related to corporations.')
    .addSubcommand(subcommand => subcommand.setName('leaderboard').setDescription('Show corporation kill report isk leaders based on final blow.')
      .addStringOption(option => option.setName('period').setDescription('The timeframe for the leaderbaord report.')
        .addChoices({ name: 'Curent Month', value: 'current-month' })
        .addChoices({ name: 'Last Month', value: 'last-month' })
        .addChoices({ name: 'Lifetime', value: 'lifetime' })
      )
      // .addStringOption(option => option.setName('kill-tag').setDescription('The kill tag to limit kill reports to.'))
    )
    .addSubcommand(subcommand => subcommand.setName('stats').setDescription('Show kill and loss stats for a corporation.')
      .addStringOption(option => option.setName('tag').setDescription('The Eve Echoes tag for the coropration.').setRequired(true))
    ),


  new SlashCommandBuilder().setName('discord').setDescription('Commands related to this discord guild.')
    .addSubcommand(subcommand => subcommand.setName('get-guild-id').setDescription('Get the ID of this Discord Guild.')),

  new SlashCommandBuilder().setName('kill-report').setDescription('Commands related to kill reports.')
    .addSubcommand(subcommand => subcommand.setName('edit').setDescription('Edit a kill report.')
      .addStringOption(option => option.setName('id').setDescription('The KMEEBO id of the kill report.'))
      .addStringOption(option => option.setName('kill-report-id').setDescription('The kill report id of the kill report.'))
      .addNumberOption(option => option.setName('isk').setDescription('The isk value on the kill report.'))
      .addNumberOption(option => option.setName('warp-scramble-strength').setDescription('The warp scramble strength on the kill report.'))
      .addNumberOption(option => option.setName('total-damage').setDescription('The total damage on the kill report.'))
      .addNumberOption(option => option.setName('participant-count').setDescription('The number of participants on the kill report.'))
      .addStringOption(option => option.setName('victim-corp').setDescription('The victim\'s corporation tag on the kill report.'))
      .addStringOption(option => option.setName('victim-name').setDescription('The victim\'s name on the kill report.'))
      .addStringOption(option => option.setName('final-blow-corp').setDescription('The final blow\'s corporation tag on the kill report.'))
      .addStringOption(option => option.setName('final-blow-name').setDescription('The final blow\'s name on the kill report.'))
      .addStringOption(option => option.setName('top-damage-corp').setDescription('The top damage\'s corporation tag on the kill report.'))
      .addStringOption(option => option.setName('top-damage-name').setDescription('The top damage\'s name on the kill report.'))
      .addStringOption(option => option.setName('killed-at').setDescription('The date and time of the kill on the kill report. (e.g. 2022/01/30 13:21:45 +0100)'))
      .addStringOption(option => option.setName('ship-type').setDescription('The type of the ship on the kill report. (e.g. Cruiser)'))
      .addStringOption(option => option.setName('ship-name').setDescription('The name of the ship on the kill report. (e.g. Arbitrator)'))
      .addStringOption(option => option.setName('region').setDescription('The region on the kill report.'))
      .addStringOption(option => option.setName('constellation').setDescription('The constellation on the kill report.'))
      .addStringOption(option => option.setName('system').setDescription('The system on the kill report.'))
      .addStringOption(option => option.setName('status').setDescription('The status of the kill report.')
        .addChoices({ name: 'SUCCESS', value: 'SUCCESS' })
        .addChoices({ name: 'ERROR', value: 'ERROR' })
        .addChoices({ name: 'INVALID', value: 'INVALID' })
      )
    )
    .addSubcommand(subcommand => subcommand.setName('export').setDescription('Export all kill reports to a CSV file.')
      .addStringOption(option => option.setName('period').setDescription('The timeframe for included kill reports.')
        .addChoices({ name: 'Curent Month', value: 'current-month' })
        .addChoices({ name: 'Last Month', value: 'last-month' })
        .addChoices({ name: 'Lifetime', value: 'lifetime' })
      )
      .addStringOption(option => option.setName('victim-corporations').setDescription('A comma delimited list of corporation tags to find kill reports for.'))
      .addStringOption(option => option.setName('start-date').setDescription('The ISO 8601 formatted date or date and time to start finding kill reports.'))
      .addStringOption(option => option.setName('end-date').setDescription('The ISO 8601 formatted date or date and time to stop finding kill reports.'))
    )
    .addSubcommand(subcommand => subcommand.setName('show').setDescription('Show information for a kill report by id.')
      .addStringOption(option => option.setName('id').setDescription('The Kmeebo defined id for the kill report.').setRequired(true))
    )
    .addSubcommand(subcommand => subcommand.setName('stats').setDescription('Statistics for kill reports.')
      .addStringOption(option => option.setName('period').setDescription('The timeframe for included kill reports.')
        .addChoices({ name: 'Curent Month', value: 'current-month' })
        .addChoices({ name: 'Last Month', value: 'last-month' })
        .addChoices({ name: 'Lifetime', value: 'lifetime' })
      )
      .addStringOption(option => option.setName('victim-corporations').setDescription('A comma delimited list of corporation tags to find kill reports for.'))
      .addStringOption(option => option.setName('start-date').setDescription('The ISO 8601 formatted date or date and time to start finding kill reports.'))
      .addStringOption(option => option.setName('end-date').setDescription('The ISO 8601 formatted date or date and time to stop finding kill reports.'))
    ),

  new SlashCommandBuilder().setName('pilot').setDescription('Commands related to pilots.')
    .addSubcommand(subcommand => subcommand.setName('leaderboard').setDescription('Show pilot kill report isk leaders based on final blow.')
      .addStringOption(option => option.setName('period').setDescription('The timeframe for the leaderbaord report.')
        .addChoices({ name: 'Curent Month', value: 'current-month' })
        .addChoices({ name: 'Last Month', value: 'last-month' })
        .addChoices({ name: 'Lifetime', value: 'lifetime' })
      )
      // .addStringOption(option => option.setName('kill-tag').setDescription('The kill tag to limit kill reports to.'))
    )
    .addSubcommand(subcommand => subcommand.setName('register').setDescription('Register your pilot names.')
      .addStringOption(option => option.setName('name').setDescription('The Eve Echoes pilot name.').setRequired(true))
    )
    .addSubcommand(subcommand => subcommand.setName('remove').setDescription('Remove a pilot.')
      .addStringOption(option => option.setName('name').setDescription('The name of the Eve Echoes pilot to remove.').setRequired(true))
    )
    .addSubcommand(subcommand => subcommand.setName('stats').setDescription('Show kill and loss stats for a pilot.')
      .addStringOption(option => option.setName('pilot').setDescription('The Eve Echoes pilot name.').setRequired(true))
    ),

  new SlashCommandBuilder().setName('user').setDescription('Commands related to users.')
    .addSubcommand(subcommand => subcommand.setName('leaderboard').setDescription('Show user kill report isk leaders based on final blow.')
      .addStringOption(option => option.setName('period').setDescription('The timeframe for the leaderbaord report.')
        .addChoices({ name: 'Curent Month', value: 'current-month' })
        .addChoices({ name: 'Last Month', value: 'last-month' })
        .addChoices({ name: 'Lifetime', value: 'lifetime' })
      )
      .addStringOption(option => option.setName('scoring').setDescription('The method used to determine how kills are attributed.')
        .addChoices({ name: 'Final Blow', value: 'final-blow' })
        .addChoices({ name: 'Top Damage', value: 'top-damage' })
        .addChoices({ name: 'Final Blow or Top Damage', value: 'final-blow-or-top-damage' })
      )
      // .addStringOption(option => option.setName('kill-tag').setDescription('The kill tag to limit kill reports to.'))
    )
    .addSubcommand(subcommand => subcommand.setName('stats').setDescription('Show kill and loss stats for a user\'s pilots.')
      .addUserOption(option => option.setName('user').setDescription('The user to show stats for.'))
      .addStringOption(option => option.setName('scoring').setDescription('The method used to determine how kills are attributed.')
        .addChoices({ name: 'Final Blow', value: 'final-blow' })
        .addChoices({ name: 'Top Damage', value: 'top-damage' })
        .addChoices({ name: 'Final Blow or Top Damage', value: 'final-blow-or-top-damage' })
      )
    )
]
  .map(command => command.toJSON())

const rest = new REST({ version: '10' }).setToken(config.Discord.botToken)

rest.put(Routes.applicationCommands(config.Discord.clientId), { body: commands })
  .then((data) => console.log(`Successfully registered ${data.length} application commands.`))
  .catch(console.error)
